Command to build a Cortex graph of reference without HLA graph:

From /Net/birch/data/dilthey/MHC-PRG/tmp2/GS_nextGen/hla/derived: (I don't know how the reference-without-HLA was generated):
 /home/dilthey/Cortex/CORTEX_release_v1.0.5.20/bin/cortex_var_31_c1 --mem_height 26 --mem_width 120 --kmer_size 25 --dump_binary Homo_sapiens.GRCh37.60.dna.chromosome.ALL.blockedHLAgraph_k25.ctx --se_list fileList_Homo_sapiens.GRCh37.60.dna.chromosome.ALL.blockedHLAgraph &> Homo_sapiens.GRCh37.60.dna.chromosome.ALL.blockedHLAgraph_k25.ctx.output
 

../bin/MHC-PRG domode createConcatenatedVariationGraphs ../tmp2/GS_nextGen/hla --noPGFprotection

../bin/MHC-PRG domode kMerify ../tmp2/GS_nextGen/hla/graph.txt --kmer 31 --noPGFprotection

../bin/MHC-PRG domode kMerify ../tmp2/GS_nextGen/hla/graph.txt --kmer 25 --noPGFprotection

../bin/MHC-PRG domode determineRequiredKMers ../tmp2/GS_nextGen/hla/graph.txt.kmers_31 ../tmp2/GS_nextGen/hla/requiredkMers_graph.txt.kmers_31 
../bin/MHC-PRG domode determineRequiredKMers ../tmp2/GS_nextGen/hla/graph.txt.kmers_25 ../tmp2/GS_nextGen/hla/requiredkMers_graph.txt.kmers_25


../bin/MHC-PRG domode filterReads --input_BAM /gpfs1/well/gsk_hla/bam_output/AA02O9Q_A2.bam --positiveFilter ../tmp2/GS_nextGen/hla/requiredkMers_graph.txt.kmers_31 --output_FASTQ test.fastQ 

../bin/MHC-PRG domode filterReads --input_BAM /gpfs1/well/gsk_hla/bam_output/AA02O9Q_A2.bam --positiveFilter ../tmp2/GS_nextGen/hla/requiredkMers_graph.txt.kmers_25 --output_FASTQ ignore


	../bin/MHC-PRG domode filterReads --input_BAM /gpfs1/well/gsk_hla/bam_output/AA02O9Q_A2.bam --positiveFilter ../tmp2/GS_nextGen/hla/requiredkMers_graph.txt.kmers_31 --output_FASTQ anotherTest.fastQ 

	../bin/MHC-PRG domode filterReads --input_BAM /gpfs1/well/gsk_hla/bam_output/AA02O9Q_A2.bam --positiveFilter ../tmp2/GS_nextGen/hla/requiredkMers_graph.txt.kmers_25 --output_FASTQ round4_positive_25_separateOptim.fastQ 

	../bin/MHC-PRG domode filterReads --input_BAM /gpfs1/well/gsk_hla/bam_output/AA02O9Q_A2.bam --positiveFilter ../tmp2/GS_nextGen/hla/requiredkMers_graph.txt.kmers_25 --output_FASTQ round5_positive_25_separateOptim.fastQ 
	
	# round 6 has origin information for individual reads
	
	../bin/MHC-PRG domode filterReads --input_BAM /gpfs1/well/gsk_hla/bam_output/AA02O9Q_A2.bam --positiveFilter ../tmp2/GS_nextGen/hla/requiredkMers_graph.txt.kmers_25 --output_FASTQ round6_positive_25_separateOptim.fastQ 
	

	
! 	../bin/MHC-PRG domode filterReads --input_BAM /gpfs1/well/gsk_hla/bam_output/AA02O9Q_A2.bam --positiveFilter ../tmp2/GS_nextGen/hla/requiredkMers_graph.txt.kmers_25 --output_FASTQ A2_positiveUnique.fastQ  --positiveUnique --uniqueness_base ../tmp2/GS_nextGen/hla/requiredkMers_graph.txt.kmers_25 --uniqueness_subtract ../tmp2/GS_nextGen/hla/derived/Homo_sapiens.GRCh37.60.dna.chromosome.ALL.blockedHLAgraph_k25.ctx



	Positive filtering
	
		../bin/MHC-PRG domode filterReads --input_FASTQ test.fastQ --positiveFilter ../tmp2/GS_nextGen/hla/requiredkMers_graph.txt.kmers_31 --output_FASTQ test_round2.fastQ
		
		../bin/MHC-PRG domode filterReads --input_FASTQ test_round2.fastQ --positiveFilter ../tmp2/GS_nextGen/hla/requiredkMers_graph.txt.kmers_25 --output_FASTQ ignore

		
		
	
	
	Negative filtering:
	
		../bin/MHC-PRG domode filterReads --input_FASTQ test.fastQ --negativeFilter ../tmp2/GS_nextGen/hla/derived/Homo_sapiens.GRCh37.60.dna.chromosome.ALL.blockedHLAgraph.ctx --output_FASTQ test_round2.fastQ
		
		../bin/MHC-PRG domode filterReads --input_FASTQ anotherTest.fastQ.fastQ --negativeFilter ../tmp2/GS_nextGen/hla/derived/Homo_sapiens.GRCh37.60.dna.chromosome.ALL.blockedHLAgraph.ctx --output_FASTQ negative_anotherTest.fastQ		

		../bin/MHC-PRG domode filterReads --input_FASTQ round3_positive_25_separateOptim.fastQ --negativeFilter ../tmp2/GS_nextGen/hla/derived/Homo_sapiens.GRCh37.60.dna.chromosome.ALL.blockedHLAgraph_k25.ctx --output_FASTQ round3_positiveANDnegative_25_separateOptim.fastQ

		../bin/MHC-PRG domode filterReads --input_FASTQ round4_positive_25_separateOptim.fastQ --negativeFilter ../tmp2/GS_nextGen/hla/derived/Homo_sapiens.GRCh37.60.dna.chromosome.ALL.blockedHLAgraph_k25.ctx --output_FASTQ round4_positiveANDnegative_25_separateOptim.fastQ
		
		../bin/MHC-PRG domode filterReads --input_FASTQ round5_positive_25_separateOptim.fastQ --negativeFilter ../tmp2/GS_nextGen/hla/derived/Homo_sapiens.GRCh37.60.dna.chromosome.ALL.blockedHLAgraph_k25.ctx --output_FASTQ round5_positiveANDnegative_25_separateOptim.fastQ

		
				
			
		../bin/MHC-PRG domode filterReads --input_FASTQ test_round2.fastQ --negativeFilter ../tmp2/GS_nextGen/hla/derived/Homo_sapiens.GRCh37.60.dna.chromosome.ALL.blockedHLAgraph_k25.ctx --output_FASTQ ignore25.fastQ

		
			../bin/MHC-PRG domode filterReads --input_BAM /gpfs1/well/gsk_hla/bam_output/AA02O9Q_A2.bam --positiveFilter ../tmp2/GS_nextGen/hla/requiredkMers_graph.txt.kmers_25 --output_FASTQ round4_positive_25_separateOptim.fastQ 

			
!	../bin/MHC-PRG domode filterReads --input_FASTQ test_positiveUnique.fastQ --negativeFilter ../tmp2/GS_nextGen/hla/derived/Homo_sapiens.GRCh37.60.dna.chromosome.ALL.blockedHLAgraph.ctx --output_FASTQ test_positiveUnique_negativePreserveUnique.fastQ --negativePreserveUnique --uniqueness_base ../tmp2/GS_nextGen/hla/requiredkMers_graph.txt.kmers_25 --uniqueness_subtract ../tmp2/GS_nextGen/hla/derived/Homo_sapiens.GRCh37.60.dna.chromosome.ALL.blockedHLAgraph.ctx_25
		
	And now align:
	
	../bin/MHC-PRG domode alignShortReadsToHLAGraph --input_FASTQ test_round2.fastQ --graphDir ../tmp2/GS_nextGen/hla --referenceGenome ../tmp2/GS_nextGen/hla/pseudoReferenceGenome.txt
	
	../bin/MHC-PRG domode alignShortReadsToHLAGraph --input_FASTQ round3_positiveANDnegative_25_separateOptim.fastQ --graphDir ../tmp2/GS_nextGen/hla --referenceGenome ../tmp2/GS_nextGen/hla/pseudoReferenceGenome.txt

	../bin/MHC-PRG domode alignShortReadsToHLAGraph --input_FASTQ round5_positiveANDnegative_25_separateOptim.fastQ --graphDir ../tmp2/GS_nextGen/hla --referenceGenome ../tmp2/GS_nextGen/hla/pseudoReferenceGenome.txt

		
../bin/MHC-PRG domode alignShortReadsToHLAGraph --input_FASTQ negative_anotherTest.fastQ --graphDir ../tmp2/GS_nextGen/hla --referenceGenome ../tmp2/GS_nextGen/hla/pseudoReferenceGenome.txt
		
		
		
! 	More aligning ...

	HLA type inference:
	
	../bin/MHC-PRG domode HLATypeInference --input_alignedReads test_round2.fastQ.aligned --graphDir ../tmp2/GS_nextGen/hla
	
	../bin/MHC-PRG domode HLATypeInference --input_alignedReads negative_anotherTest.fastQ.aligned --graphDir ../tmp2/GS_nextGen/hla
	
	
	
	../bin/MHC-PRG domode alignShortReadsToHLAGraph --input_FASTQ round3_positiveANDnegative_25_separateOptim.fastQ --graphDir ../tmp2/GS_nextGen/hla --referenceGenome ../tmp2/GS_nextGen/hla/pseudoReferenceGenome.txt
	
	../bin/MHC-PRG domode alignShortReadsToHLAGraph --input_FASTQ round4_positiveANDnegative_25_separateOptim.fastQ --graphDir ../tmp2/GS_nextGen/hla --referenceGenome ../tmp2/GS_nextGen/hla/pseudoReferenceGenome.txt

	../bin/MHC-PRG domode alignShortReadsToHLAGraph --input_FASTQ round5_positiveANDnegative_25_separateOptim.fastQ --graphDir ../tmp2/GS_nextGen/hla --referenceGenome ../tmp2/GS_nextGen/hla/pseudoReferenceGenome.txt
	
		../bin/MHC-PRG domode HLATypeInference --input_alignedReads round3_positiveANDnegative_25_separateOptim.fastQ.aligned --graphDir ../tmp2/GS_nextGen/hla &> HLAtypes_round3_positiveANDnegative_25_separateOptim.txt

		../bin/MHC-PRG domode HLATypeInference --input_alignedReads round4_positiveANDnegative_25_separateOptim.fastQ.aligned --graphDir ../tmp2/GS_nextGen/hla &> HLAtypes_round4_positiveANDnegative_25_separateOptim.txt
		
		../bin/MHC-PRG domode HLATypeInference --input_alignedReads round5_positiveANDnegative_25_separateOptim.fastQ.aligned --graphDir ../tmp2/GS_nextGen/hla &> HLAtypes_round5_positiveANDnegative_25_separateOptim.txt
		
	
../bin/MHC-PRG domode describekMerGraph ../tmp2/GS_nextGen/hla/graph.txt.kmers_31 ../tmp2/GS_nextGen/hla/derived/ HLAGRAPH_31 --output_kMer_levels --referenceGenomeCortexGraph ../tmp2/GS_nextGen/hla/derived/Homo_sapiens.GRCh37.60.dna.chromosome.ALL.blockedHLAgraph.ctx

## this does not work, for there is no PGF protection

../bin/MHC-PRG domode simulationSuite ../tmp2/GS_nextGen/hla/graph.txt.kmers_31 ../tmp/ SIMU_HLA --genotypingMode 8

## estimate some insert size

dilthey@sequoia:~/picard/picard-tools-1.83$ java -jar CollectInsertSizeMetrics.jar INPUT=/gpfs1/well/gsk_hla/bam_output/AA02O9Q_A1.bam H=HIST_AA02O9Q_A1 O=INSERTSIZE_AA02O9Q_A1

## simulations

../bin/MHC-PRG domode testGraphAligner_realGraph ../tmp2/GS_nextGen/hla/graph.txt



## script

./HLAtypeinference.pl --sampleIDs AA02O9Q_A2 --actions n

./HLAtypeinference.pl --sampleIDs I1_AA02O9Q_A1,I1_AA02O9Q_A2,I1_AA02O9Q_A3,I1_AA02O9Q_A6 --actions a


./HLAtypeinference.pl --sampleIDs AA02O9Q_A2 --actions v --trueHLA /home/dilthey/GSK_NG/GSK_NGclassicalHLA_withG.txt
